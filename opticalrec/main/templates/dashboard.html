{% extends "base_template.html" %}
{% block js %}
{% load static %}
{% load dict_lookup %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
{%block content%}
<div class='containter'>
<h1 style="text-align:center">Dashboard</h1>
{% if user.is_authenticated %}
  <div class='row justify-content-center g-0 mx-0'>
    {% for keybtn, valuebtn in data.items %}
    <div class='col-2' style="width:auto; padding: 5px">
    <button onclick='toggleView("div.{{keybtn}}")' class="btn btn-primary mt-3 dashboard level-1" id="{{keybtn}}">{{videos|keyvalue:keybtn}}</button> <br/>
    </div>
    {% endfor %}
  </div>
  
    {% for keybtn, valuebtn in data.items %}
    <div class='row justify-content-center g-0 mx-0 collapse level-1 dashboard' id='div.{{keybtn}}'>
      <h2 style="text-align:center">{{videos|keyvalue:keybtn}}</h2>
      {% for i in valuebtn%}
         {% for kbtn, vbtn in i.items %}
        <div class='col-2' style="width:auto; padding: 5px">
        <button onclick='toggleView("table.{{keybtn}}.{{kbtn}}")' class="btn btn-secondary mt-3 dashboard level-2" id="{{keybtn}}.{{kbtn}}">{{kbtn}}</button>  
        </div>
      
        {% endfor %}
      
    {% endfor %}
  </div>
    {% endfor %}
  


    {% for key, value in data.items %}
     {% for item in value %}  
      {% for k, v in item.items %}  
    <table class="table table-striped collapse level-2 dashboard" id="table.{{key}}.{{k}}">
      <thead> 
        <caption style="caption-side:top; text-align:center">{{k}}</caption>
        <tr>
          <th scope="col">Value</th>
          <th scope="col">Difference</th>
          <th scope="col">Timestamp</th>
        </tr>
      </thead>
      <tbody>
        {% for data in v %}
        <tr>
          <td> {{data.value}} </td>
          <td> {{data.valueChange}}</td>
          <td> {{data.timeStamp}}</td>
        </tr>

          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
        {% endfor %}


    {% empty %}
    <h2>No Data Found</h2>
    {% endfor %}

    <div id="javascript">
      <script>
        function toggleView(tbl) {
          var x = document.getElementById(tbl);
          var tables = document.getElementsByClassName('dashboard');

          for(var i=0; i<tables.length; i++){
            if (x.classList.contains('level-2') && tables[i].classList.contains('level-1')){
              continue;
              } else if (tables[i].tagName=='BUTTON'){
                    if (x.id.includes(tables[i].id)){
                      tables[i].classList.add('active');
                    } else {
                      tables[i].classList.remove('active');
                    }
              } else if (tables[i].id!=x.id){
                  tables[i].classList.remove('show');
            
          }
        }
          if (x.classList.contains('show')){
            x.classList.remove('show');
          } else{
            x.classList.add('show');
          }
        } 
      </script>
  </div>
{% else %}
  <p><a href="{% url 'profile' %}">You need to be logged in</a></p>
{% endif %}
  <p><a href="{% url 'index' %}">Return to home</a></p>
{% endblock %}
</div>